<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta id="_csrf" name="_csrf" th:content="${_csrf.token}"/>
    <!-- default header name is X-CSRF-TOKEN -->
    <meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Blind</title>

    <!-- Bootstrap core CSS -->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../css/blog-home.css" rel="stylesheet">

</head>

<body>

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="../main">BLIND</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="../main">Home
                        <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="modal" data-target="#savePostsModal">게시하기</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/dashboard">Dash Board</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="modal" data-target="#changeNick">내 정보 수정</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/logout">로그아웃</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Page Content -->
<div class="container">
    <div class="row">
        <!-- Blog Entries Column -->
        <div class="col-md-8">
            <h1 class="my-4" th:text="${board.boardSubject}"></h1>
            <input type="hidden" th:value="${board.boardId}" id="boardId"/>
            <div id="modifyArticle"></div>

            <div class="row my-4">
                <div class="col-lg-8">
                    <img class="img-fluid rounded" th:src="${board.filePath}" alt="">
                </div>
                <div class="col-lg-4">
                    <textarea style="resize:none;overflow:auto" th:text="${board.boardContents}" readonly="readonly" cols="70" rows="12"></textarea>
                </div>
            </div>
            작성자 : <label th:text="${board.writer}"></label>
            &nbsp;&nbsp;&nbsp;&nbsp;조회수 : <label th:text="${board.viewCnt}"></label>
            &nbsp;&nbsp;&nbsp;&nbsp;좋아요 수 : <label th:text="${board.likeCnt}"></label>

            <label th:text="${board.boardDate}"></label>

            <div>


                <div class="my-3 p-3 bg-white rounded shadow-sm">
                    <div class="container">
                        <h6 class="border-bottom border-gray pb-2 mb-0">댓글</h6>
                        <div id="sessionEmail" type="hidden" style="display:none;">[[${#httpServletRequest.remoteUser}]]</div>
                        <form name="replyInsertForm" id="replyInsertForm">
                            <div class="input-group">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <input type="hidden" name="boardId" id="paramBoardId" th:value="${board.boardId}"/>
                                <input type="text" class="form-control" id="replyContents" name="replyContents" placeholder="댓글을 입력하세요.">
                                <span class="input-group-btn">
                             <button class="btn btn-default" type="button" name="btnReply" id="btnReply">등록</button>
                           </span>
                            </div>
                        </form>
                    </div>

                    <div class="media text-muted pt-3">
                        <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                            <div>
                                <strong class="text-gray-dark">사용자 닉네임</strong>
                                <a href="#">수정</a>
                                <a href="#">삭제</a>
                                <a href="#">더보기</a>
                            </div>
                            <span class="d-block">댓글 내용</span>
                            <span class="d-block">날짜</span>
                        </div>
                    </div>

                    <div class="media text-muted pt-3">
                        <p class="mr-2"  style="width: 32px; height: 32px;"> ▶ </p>
                        <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                            <div class="d-flex justify-content-between align-items-center w-100">
                                <strong class="text-gray-dark">Full Name</strong>
                                <a href="#">Follow</a>
                            </div>
                            <span class="d-block">@username</span>
                        </div>
                    </div>
                    <small class="d-block text-right mt-3">
                        <a href="#">더보기</a>
                    </small>
                    <div class="media text-muted pt-3">
                        <div class="media-body pb-3 mb-0 small lh-125 border-bottom border-gray">
                            <div>
                                <strong class="text-gray-dark">사용자 닉네임</strong>
                                <a href="#">수정</a>
                                <a href="#">삭제</a>
                                <a href="#">더보기</a>
                            </div>
                            <span class="d-block">댓글 내용</span>
                            <span class="d-block">날짜</span>
                        </div>
                    </div>
                </div>

                <div class="container">
                    <div id="replyList"></div>
                    <button type="button" class="btn btn-primary" id="btnMoreReply">더보기</button>
                </div>
            </div>
        </div>
    </div>

</div>



<div class="modal fade" id="savePostsModal" tabindex="-1" role="dialog" aria-labelledby="savePostsLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="posting">게시글 등록</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id = "fileForm"  encType="multipart/form-data">
                    <div class="form-group">
                        <label for="imgFile">이미지</label>
                        <input type="file" class="form-control" name="postFile" id="imgFile" placeholder = "사진 업로드 하기">
                    </div>
                    <div class="form-group">
                        <label for="writeSubject">제목</label>
                        <input type="text" class="form-control" name = "boardSubject" id="writeSubject" placeholder="제목을 입력하세요" required = "true" maxlength="500">
                    </div>
                    <div class="form-group">
                        <label for="writeContent"> 내용 </label>
                        <textarea class="form-control" name = "boardContents" id="writeContent" placeholder="내용을 입력하세요" required = "true" maxlength="2000"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnWrite">등록</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="changeNick" tabindex="-1" role="dialog" aria-labelledby="savePostsLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="savePostsLabel">닉네임 수정</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="nickName">변경할 닉네임</label>
                        <input type="text" id="nickName" class="form-control" placeholder="변경하실 닉네임을 작성하세요.">
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnModifyNick">등록</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnDeleteMember">회원 탈퇴</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="updatingModal" tabindex="-1" role="dialog" aria-labelledby="savePostsLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updating">게시글 수정</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="updateForm" th:action="@{/${board.boardId}}" encType="multipart/form-data">
                    <div class="form-group">
                        <label for="imgFile">이미지</label>
                        <input type="file" class="form-control" name="updateFile" id="updateImgFile"
                               placeholder="사진 수정 하기">
                    </div>
                    <div class="form-group">
                        <label for="writeSubject">제목</label>
                        <input type="text" class="form-control" th:value="${board.boardSubject}" name="boardSubject"
                               id="updateSubject" placeholder="제목을 입력하세요" required="true" maxlength="500">
                    </div>
                    <div class="form-group">
                        <label for="writeContent"> 내용 </label>
                        <textarea class="form-control" name="boardContents" th:text="${board.boardContents}"
                                  id="updateContent" placeholder="내용을 입력하세요" required="true"
                                  maxlength="2000"></textarea>
                    </div>
                </form>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnUpdate">수정</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="deletingModal" tabindex="-1" role="dialog" aria-labelledby="savePostsLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleting">게시글을 삭제하시겠습니까?</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" id="btnDelete">삭제</button>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap core JavaScript -->
<script src="../vendor/jquery/jquery.min.js"></script>
<script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="../js/update.js"></script>
<script src="../js/reply.js"></script>
<script src="../js/modifyUser.js"></script>

<script th:inline="javascript">
    $(document).ready(function () {
        var session = /*[[${#httpServletRequest.remoteUser}]]*/;
        var memberEmail = /*[[${board.writerEmail}]]*/

        console.log(session +" "+memberEmail)
        if (session == memberEmail) {
            var modifyHTML = "";
            modifyHTML += '<div class="col-lg-4">';
            modifyHTML += '<a class="btn btn-primary btn-lg" data-toggle="modal" data-target="#updatingModal">수정</a>';
            modifyHTML += '<a class="btn btn-primary btn-lg" data-toggle="modal" data-target="#deletingModal">삭제</a>';
            modifyHTML += '</div>';

            $("#modifyArticle").html(modifyHTML);
        }
    });
</script>
</body>

</html>
